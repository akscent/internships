

# Проверка гипотез с двумя группами лечения

Предположим, что фармацевтическая компания провела клиническое исследование (КИ), сравнивая эффективность нового препарата (Препарат A) и уже доступного препарата (Препарат B) в уменьшении симптомов. Исследование включает две группы лечения: одну группу пациентов, получающих Препарат A, и другую группу, получающих Препарат B. Данные ниже представляют процентное снижение симптомов для обеих групп:

**Препарат A: `48, 52, 55, 39, 60, 57, 46, 53, 50, 45, 63, 51, 40, 37, 44`**

**Препарат B: `42, 46, 39, 35, 52, 49, 38, 41, 47, 36, 54, 50, 33, 30, 43`**

Запишем эти данные в векторное представление:

```{r}
preparatA <- c(48, 52, 55, 39, 60, 57, 46, 53, 50, 45, 63, 51, 40, 37, 44)
preparatB <- c(42, 46, 39, 35, 52, 49, 38, 41, 47, 36, 54, 50, 33, 30, 43)
```

Фармацевтическая компания утверждает, что Препарат A более эффективен, чем Препарат B, с более высоким средним процентом снижения симптомов.

```{r, mean}
df <- data.frame(group=c("Препарат A", "Препарат B"), mean=c(mean(preparatA), mean(preparatB)))
ggplot(df, aes(x=group, y=mean)) +
  geom_bar(stat="identity", fill="blue", alpha=0.5) +
  geom_text(aes(label=round(mean,2)), vjust=1.5, color="white", size=5) +
  ggtitle("Сравнение среднего снижения симптомов") +
  ylab("Снижение симптомов, %") +
  xlab("Группа препарата") +
  theme_bw()
```

**a) Сформулируйте нулевую и альтернативную гипотезы для проверки этого утверждения.**

`Нулевая гипотеза (H0): Средние значения процентного снижения симптомов для Препарата A и Препарата B одинаковы. Альтернативная гипотеза (HA): Средние значения процентного снижения симптомов для Препарата A и Препарата B отличаются.`

**b) Выполните двухвыборочный t-тест, чтобы определить, является ли разница в среднем проценте снижения симптомов между двумя препаратами статистически значимой на уровне значимости 5%. Обязательно включите все соответствующие расчеты, предположения и статистические показатели.**

```{r, t-test}
t.test(preparatA, preparatB, alternative = "two.sided", var.equal = TRUE, conf.level = 0.95)
```

**c) Интерпретируйте результаты t-теста и сделайте вывод о заявлении компании.**

**Вывод:** значение t-статистики равно 2.5727, с p-значением 0.01568, что меньше уровня значимости 0.05. Таким образом, мы можем отклонить нулевую гипотезу о равенстве средних значений процентного снижения симптомов между Препаратом A и Препаратом B на уровне значимости 5%. Это означает, что есть статистически значимое различие в среднем процентном снижении симптомов между Препаратом A и Препаратом B.

**d) Для данных какого вида t-тест применим, а для каких нет? Объясните.**

Мы провели двухвыборочный t-тест для независимых выборок, поскольку по условиям задачи известно, что пациенты из разных групп не зависимы. Также следует отметить, что мы используем t-тест (параметрический метод) для нормально распределенных данных. Однако для достоверности теста, необходимо проверить, действительно ли номрально распределены данные. Это необходимо сделать еще и потому, что условное разделение достаточности выборки для нормальности (n \> 30) не выдерживается для наших наборов данных n = 26. Если бы наши данные были не нормально распределены, то мы могли бы использовать непараметрический тест, например, тест Уилкоксона-Манна-Уитни.

Приведем некоторые графические данные для проверки на нормальность выборки:

```{r, normal distribution}
# Двойное окно для графиков
par(mfrow=c(1,2))
# Построим графики распределения частоты данных 
hist(preparatA, main="Препарат A", xlab="Снижение симптомов, %", ylab = "Частота")
hist(preparatB, main="Препарат B", xlab="Снижение симптомов, %", ylab = "Частота")

# Создание Q-Q plot для Preparat A
qqnorm(preparatA, main = "Q-Q plot для Препарата A", xlab = "", ylab = "")
qqline(preparatA, col = "red", lty = 2)
legend("topleft", legend=c("Реальные данные", "Норм. распределение"), lty=1:2, col=c("black", "red"), bty="n")

# Создание Q-Q plot для Preparat B
qqnorm(preparatB, main = "Q-Q plot для Препарата В", xlab = "", ylab = "")
qqline(preparatB, col = "red", lty = 2)
legend("topleft", legend=c("Реальные данные", "Норм. распределение"), lty=1:2, col=c("black", "red"), bty="n")

```

Теперь првоерим нормальность распределения при помощи теста Шапиро-Уилка:

```{r, shapiro test}
# Тест Шапиро-Уилка для Preparat A
shapiro.test(preparatA)

# Тест Шапиро-Уилка для Preparat B
shapiro.test(preparatB)
```

p-value в обоих случаях больше 0.05, таким образом, с 95% вероятностью мы можем утверждать, что данные не отличаются значимо от нормального распределения. **Таким образом, выводы, сделанные изначально о более высоком среднем воздействии препарата А статистически значимы.**

\-\-\-\-\-\-\-\-\-\-\-\-\-\--

# Расчет размера выборки

Фармацевтическая компания планирует провести новое КИ для сравнения эффективности двух препаратов, Препарат A и Препарат B, для лечения хронического заболевания. Основным критерием оценки является процентное снижение симптомов после трех месяцев лечения. Компания стремится обнаружить минимальную разницу в 5% между двумя препаратами, имея мощность 80% и уровень значимости 5%.

**a) Предполагая, что стандартные отклонения для обеих групп равны, рассчитайте требуемый размер выборки для каждой группы, используя двухвыборочный t-тест. Используйте следующую информацию для выполнения расчетов:**

-   Стандартное отклонение процентного снижения симптомов для обоих препаратов оценивается в 10%.

-   Уровень значимости (альфа) установлен на уровне 0,05.

-   Желаемая мощность (1-бета) составляет 0,80.

Для расчета размера выборки мы можем использовать следующую формулу:

$n = (Z_a + Z_b)^2 * (σ^2 / δ^2)$

*где:
Z_a - значение стандартного нормального распределения для выбранного уровня значимости (5%), что равно 1,96;
Z_b - значение стандартного нормального распределения для желаемой мощности (80%), что равно 0,84;
σ - стандартное отклонение процентного снижения симптомов для обоих препаратов, что равно 10%;
δ - минимально обнаружимая разница между двумя препаратами, что равно 5%.*

```{r}
# установим значения параметров
alpha <- 0.05
beta <- 0.2
power <- 1 - beta
sigma <- 0.1
d <- 0.05

# рассчитаем размер выборки
z_a <- qnorm(1 - alpha/2)
z_b <- qnorm(power)
n <- ceiling((z_a + z_b)^2 *  (sigma^2 / d^2))
n

```

**b) Обсудите, как изменится размер выборки, если компания захочет увеличить мощность исследования до 90%, сохраняя тот же уровень значимости и минимально обнаружимую разницу.**

```{r}
beta <- 0.1
power <- 1 - beta

# рассчитаем размер выборки с новым параметром
z_b <- qnorm(power)
n <- ceiling((z_a + z_b)^2 *  (sigma^2 / d^2))
n
```

Таким образом, при увеличении мощности до 90% необходимо провести исследование на 43 пациентах в каждой группе.

**c) Объясните последствия использования выборки меньшего размера, чем рассчитано в пункте (a), с точки зрения ошибок первого и второго рода и последствий для достоверности выводов исследования.**

Использование выборки меньшего размера, чем рассчитано в пункте (a), может привести к ошибкам первого и второго рода, а также может повлиять на достоверность выводов исследования.

Ошибка первого рода происходит, когда мы отвергаем верную нулевую гипотезу. Это означает, что мы можем ошибочно считать, что различие между двумя препаратами существует, когда на самом деле его нет. Уменьшение размера выборки может увеличить вероятность такой ошибки.

Ошибка второго рода происходит, когда мы не отвергаем нулевую гипотезу, когда она на самом деле неверна. Это означает, что мы можем не обнаружить различий между двумя препаратами, когда на самом деле они есть. Уменьшение размера выборки может увеличить вероятность и такой ошибки.

Кроме того, использование выборки меньшего размера может привести к снижению достоверности выводов исследования. Меньший размер выборки означает меньшую точность исследования и более широкие доверительные интервалы, что может привести к тому, что результаты исследования не будут достаточно надежными. В результате мы можем не обнаружить различия между препаратами, даже если они есть.

# Регуляторика

**Перечислите, какие Вы знаете регуляторные нормы (законодательные акты, стандарты или общепринятые гайдлайны) применимые к статистической методологии в планировании и анализе данных КИ в странах ЕС, а также в России (ЕАЭС).**

В Европейском Союзе существуют ряд регуляторных норм, применимых к статистической методологии в планировании и анализе данных клинических исследований. Некоторые из них включают:

1.  Регламент (ЕС) № 536/2014 - Регламент о клинических исследованиях на лекарственных средствах для человека. Он содержит требования к планированию, проведению, мониторингу и отчетности клинических исследований на лекарственные средства, включая использование статистических методов.

2.  Директива 2001/20/EC - Директива Европейского парламента и Совета о проведении клинических исследований на лекарственных средствах для человека. Эта директива устанавливает общие принципы и требования к проведению клинических исследований, включая требования к статистическому анализу данных.

3.  Методологические указания по проведению клинических исследований лекарственных средств, утвержденные решением Минздрава РФ от 31.07.2015 г. № 58н. В них указываются требования к планированию, проведению и анализу клинических исследований на лекарственные средства в России, включая требования к статистическому анализу данных.

4.  GCP-стандарты (Good Clinical Practice) - международные стандарты, разработанные Международной конференцией по гармонизации требований к клиническим испытаниям лекарственных средств (ICH). Они содержат требования к планированию, проведению, мониторингу и отчетности клинических исследований, включая использование статистических методов.

5.  Руководство E9 (ICH) - Руководство по статистическому анализу данных в клинических исследованиях. Оно содержит рекомендации по статистическому анализу данных, включая методы выбора размера выборки, анализа данных, допустимые методы интерпретации результатов и т.д.

В странах ЕАЭС (Евразийского экономического союза) применяются следующие регуляторные нормы, касающиеся статистической методологии в планировании и анализе данных КИ:

1.  Технический регламент Таможенного союза ТР ТС 012/2011 "О безопасности оборудования для работы во взрывоопасных средах". Данный технический регламент определяет требования к обеспечению безопасности при проведении клинических исследований взрывозащищенных медицинских изделий.

2.  Регламент ЕАЭС № 10/2016 "О безопасности медицинских изделий". В этом регламенте установлены требования к клиническим испытаниям медицинских изделий, включая требования к статистической методологии при планировании и анализе данных КИ.

3.  Методические рекомендации по проведению клинических исследований медицинских изделий, утвержденные Минздравом России. В этих рекомендациях приводятся требования к планированию и проведению клинических исследований медицинских изделий, включая требования к статистической методологии.

4.  Стандарты ISO 14155:2020 "Клинические исследования медицинских изделий на людях - Руководство по хорошей клинической практике". Данный стандарт устанавливает требования к планированию, проведению и отчетности клинических исследований медицинских изделий, включая требования к статистической методологии.
